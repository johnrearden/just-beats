{% extends 'base.html' %}

{% load static %}

{% block content %}

<div class="container-md vert-gap-100">
    <div class="row">
        <div class="col-lg-4 text-center align-self-center darker-background p-5">
            <h1>Feeling Creative?</h1>
            <p>Why not create a new loop of your own? Click here to start!</p>
            <div>
                <a href="{% url 'new_drumloop_form' %}">
                    <button id="create-new-loop-button">Create New Loop</button>
                </a>
            </div>
        </div>
        <div class="col-lg-8 text-center">
            <h1 class="text-center beats-header">Drumloops</h1>
            <div class="container">
                <div class="row">
                    {% if selection == 'all' %}
                    <div class="col-3 offset-3">
                        <a href="{% url 'home' 'all' %}">
                            <button id="all-loops" class="highlighted-button">All Loops</button>
                        </a>
                    </div>
                    <div class="col-3">
                        <a href="{% url 'home' 'user_only' %}">
                            <button id="my-loops">My Loops</button>
                        </a>
                    </div>
                    {% else %}
                    <div class="col-3 offset-3">
                        <a href="{% url 'home' 'all' %}">
                            <button id="all-loops">All Loops</button>
                        </a>
                    </div>
                    <div class="col-3">
                        <a href="{% url 'home' 'user_only' %}">
                            <button id="my-loops" class="highlighted-button">My Loops</button>
                        </a>
                    </div>
                    </a>
                    {% endif %}
                    <div class="col-6">
                        
                    </div>
                </div>
            </div>
            
            
            <table class="drumloop-table mt-3">
                <thead>
                    <tr>
                        <th scope="col">Creator</th>
                        <th scope="col">Name</th>
                        <th scope="col" class="d-none d-md-inline">Tempo</th>
                        <th scope="col" class="d-none d-sm-inline">Rating</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for loop in drumloops %}
                    <tr class="drumloop-table-row">
                        <td class="drumloop-table-item">
                            {{ loop.creator }}
                        </td>
                        <td class="drumloop-table-item">
                            {{ loop.name }}
                        </td>
                        <td id="tempo" class="drumloop-table-item loop-tempo d-none d-md-inline">
                            {{ loop.tempo }}
                        </td>
                        <td id="rating-display-{{forloop.counter0}}" class="d-none d-sm-inline">
                        </td>
                        <td>
                            <!-- Store the loop fields necessary for creating the DrumLoop object-->
                            <i data-id="{{ loop.id }}" data-tempo="{{ loop.tempo }}" 
                                data-name="{{ loop.name }}" data-user="{{ user.username }}" 
                                data-creator="{{ loop.creator }}" 
                                class="fa-regular fa-circle-play play-button">
                            </i>
                        </td>
                        <td>
                            {% if user == loop.creator %}
                            <a href="{% url 'loop_editor' loop.id %}">
                                <button class="edit-button">Edit</button>
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    <input readonly class="d-none" id="rating-{{ forloop.counter0 }}" value="{{loop.rating}}">
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div id="current-track-display" class="col-md-10 offset-md-1 text-center mt-5 invisible">
            <h3>Now playing ... </h3>
            <h1><span id="playing-track-name" class="fst-italic"></span></h1>
            <button id="rating-launcher-button" class="mt-3" en>
                Give it a rating
            </button>
        </div>
    </div>
</div>

<!-- This script is placed inline as it is tightly bound to the ratings element 
     of this template, and cannot be reused elsewhere -->
<script>
    const loopCount = document.getElementsByClassName('drumloop-table-row').length;
    for (let i = 0; i < loopCount; i++) {
        let literal = `rating-${i}`;
        const rating = document.getElementById(literal).value;
        const ratingDisplay = document.getElementById(`rating-display-${i}`);
        for (let j = 1; j <= 5; j++) {
            const newElement = document.createElement("span");
            if (j <= rating) {
                newElement.innerHTML = `<i class="fa-solid fa-star rating-star"></i>`;
            } else {
                newElement.innerHTML = `<i class="fa-regular fa-star rating-star"></i>`;
            }
            ratingDisplay.appendChild(newElement);
        }
    }
</script>

<script>
    /*
    This JavaScript snippet maps the audio file URLs stored in the database
    to the URLs on Cloudinary, which hash the filenames so that browser caches
    are invalidated where necessary. Must be inline to avail of templating.
    */
    const drumURLs = {
        "audio/kick_swooshy.wav": "{% static 'audio/kick_swooshy.wav'|escapejs %}",
        "audio/perc_wobble.wav": "{% static 'audio/perc_wobble.wav'|escapejs %}",
        "audio/snare_breathe.wav": "{% static 'audio/snare_breathe.wav'|escapejs %}",
        "audio/hats_micro.wav": "{% static 'audio/hats_micro.wav'|escapejs %}",
        "audio/kick_hard.wav": "{% static 'audio/kick_hard.wav'|escapejs %}",
        "audio/clap_liquid.wav": "{% static 'audio/clap_liquid.wav'|escapejs %}",
        "audio/clap_vinyl.wav": "{% static 'audio/clap_vinyl.wav'|escapejs %}",
        "audio/hats_massamola.wav": "{% static 'audio/hats_massamola.wav'|escapejs %}",
        "audio/hats_metal.wav": "{% static 'audio/hats_metal.wav'|escapejs %}",
        "audio/hats_zippo.wav": "{% static 'audio/hats_zippo.wav'|escapejs %}",
        "audio/hihat_808.wav": "{% static 'audio/hihat_808.wav'|escapejs %}",
        "audio/kick_borefest.wav": "{% static 'audio/kick_borefest.wav'|escapejs %}",
        "audio/kick_coffee_shop.wav": "{% static 'audio/kick_coffee_shop.wav'|escapejs %}",
        "audio/kick_juicy.wav": "{% static 'audio/kick_juicy.wav'|escapejs %}",
        "audio/kick_stomp.wav": "{% static 'audio/kick_stomp.wav'|escapejs %}",
        "audio/kick_tape.wav": "{% static 'audio/kick_tape.wav'|escapejs %}",
        "audio/kick_tight.wav": "{% static 'audio/kick_tight.wav'|escapejs %}",
        "audio/perc_808.wav": "{% static 'audio/perc_808.wav'|escapejs %}",
        "audio/perc_hollow.wav": "{% static 'audio/perc_hollow.wav'|escapejs %}",
        "audio/perc_laser.wav": "{% static 'audio/perc_laser.wav'|escapejs %}",
        "audio/perc_nasty.wav": "{% static 'audio/perc_nasty.wav'|escapejs %}",
        "audio/perc_skipper.wav": "{% static 'audio/perc_skipper.wav'|escapejs %}",
        "audio/perc_springboard.wav": "{% static 'audio/perc_springboard.wav'|escapejs %}",
        "audio/perc_tambo.wav": "{% static 'audio/perc_tambo.wav'|escapejs %}",
        "audio/perc_weirdo.wav": "{% static 'audio/perc_weirdo.wav'|escapejs %}",
        "audio/snare_electro.wav": "{% static 'audio/snare_electro.wav'|escapejs %}",
        "audio/snare_lastbar.wav": "{% static 'audio/snare_lastbar.wav'|escapejs %}",
        "audio/snare_lofi.wav": "{% static 'audio/snare_lofi.wav'|escapejs %}",
        "audio/snare_tight.wav": "{% static 'audio/snare_tight.wav'|escapejs %}",
        "audio/tom_acoustic.wav": "{% static 'audio/tom_acoustic.wav'|escapejs %}",
        "audio/tom_short.wav": "{% static 'audio/tom_short.wav'|escapejs %}",
    }
</script>

<script src="{% static 'js/LoopPlayer.js' %}" type="text/javascript"></script>
<script src="{% static 'js/LoopList.js' %}" type="text/javascript"></script>

{% endblock %}